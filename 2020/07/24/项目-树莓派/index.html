<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="项目 / 树莓派"><meta name="keywords" content=""><meta name="author" content="Inter"><meta name="copyright" content="Inter"><title>项目 / 树莓派 | Zichuan365' Blog</title><link rel="shortcut icon" href="/22.jpg"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#液面检测-位姿判断"><span class="toc-number">1.</span> <span class="toc-text">液面检测 &#x2F; 位姿判断</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-项目需求"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.项目需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Modbus通讯"><span class="toc-number">1.0.2.</span> <span class="toc-text">2.Modbus通讯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-工作流程"><span class="toc-number">1.0.3.</span> <span class="toc-text">3.工作流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-工作流程（精简）"><span class="toc-number">1.0.4.</span> <span class="toc-text">4.工作流程（精简）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-算法"><span class="toc-number">1.0.5.</span> <span class="toc-text">5.算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-问题解决"><span class="toc-number">1.0.6.</span> <span class="toc-text">6.问题解决</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-硬件选型"><span class="toc-number">1.0.7.</span> <span class="toc-text">7.硬件选型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-算法介绍"><span class="toc-number">1.0.8.</span> <span class="toc-text">8.算法介绍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PNP螺丝漏打识别-透视投影"><span class="toc-number">2.</span> <span class="toc-text">PNP螺丝漏打识别 &#x2F; 透视投影</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/22.jpg"></div><div class="author-info__name text-center">Inter</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">20</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">3</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">21</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://blog.csdn.net/Kano365" target="_blank" rel="noopener">CSDN</a><a class="author-info-links__name text-center" href="https://www.baidu.com/" target="_blank" rel="noopener">Baidu</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/6.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Zichuan365' Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/gallery">Gallery</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">项目 / 树莓派</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-07-24</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%A1%B9%E7%9B%AE/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="液面检测-位姿判断"><a href="#液面检测-位姿判断" class="headerlink" title="液面检测 / 位姿判断"></a>液面检测 / 位姿判断</h2><h4 id="1-项目需求"><a href="#1-项目需求" class="headerlink" title="1.项目需求"></a>1.项目需求</h4><ol>
<li>试管名称：一次性使用采样器。（大规模送检测试器皿）</li>
<li>作用：类似于验血时的一次性保存容器，通过棉签擦拭部位然后采集液体。<br>（液体类似酒精混合物）</li>
<li>项目需求：通过相机采集规定ROI区域内：试管内棉签的位姿状态和样本液体的高度数据。<ul>
<li>高度误差： +-1mm————防止下针采集时刺穿了采样器。</li>
<li>角度误差： +-10°————主要了为了判断出棉签是靠左还是靠右，这样可以云台控住的采集器可以下针吸取液体。<br><img src="/pictures/clipboard39.png" alt="img1"></li>
</ul>
</li>
</ol>
<hr>
<h4 id="2-Modbus通讯"><a href="#2-Modbus通讯" class="headerlink" title="2.Modbus通讯"></a>2.Modbus通讯</h4><ul>
<li><blockquote>
<p>Modbus主要有<strong>线圈寄存器</strong>和<strong>保持寄存器</strong>。前者支持0和1的输入输出，常用于控制开关,保持寄存器常用于读写数据。</p>
</blockquote>
</li>
<li><blockquote>
<p>0x10: 写多个保持寄存器/16示例：<br><img src="/pictures/clipboard40.png" alt="功能码16"></p>
</blockquote>
</li>
<li><blockquote>
<p>树莓派网络设置：</p>
</blockquote>
</li>
</ul>
<ol>
<li>IP: 192.168.178.100</li>
<li>Mask: 255.255.255.0</li>
<li>Timeout: 1000ms</li>
<li>Port: 502</li>
<li>ModbusTCPSlave</li>
<li>功能码0x17 / 23读写多个保持寄存器</li>
</ol>
<hr>
<ul>
<li><blockquote>
<p>0x17: 读写多个保持寄存器<br><img src="/pictures/clipboard41.png" alt="功能码23"></p>
</blockquote>
</li>
</ul>
<ol>
<li><p>主站询问报文：一般由三部分组成，</p>
<ol>
<li>报头：7字节的报头，</li>
<li>数据大小和起始位置：1字节表示功能码，4字节高低位的数量和起始位，</li>
<li>具体的交互数据：1字节统计总数，输入数据字节1，字节2，字节3 ，我们共10字节</li>
</ol>
</li>
<li><p>从站应答报文：对应主站报文</p>
</li>
<li><p>一个数据2个字节，高位和地位0-65535</p>
</li>
<li><p>在对应的交互数据中写入数据，返回报文</p>
<table>
<thead>
<tr>
<th>主站写</th>
<th>主站写</th>
<th>从站写</th>
<th>从站写</th>
<th>从站写</th>
</tr>
</thead>
<tbody><tr>
<td>数据1</td>
<td>数据2</td>
<td>数据3</td>
<td>数据4</td>
<td>数据5</td>
</tr>
<tr>
<td>1.检索命令</td>
<td>2.试管类型编号</td>
<td>3.棉签角度</td>
<td>4.液面高度</td>
<td>5模板高度</td>
</tr>
</tbody></table>
</li>
</ol>
<ul>
<li>错误码返回说明：<ul>
<li>1.当出入试管类型不存在，返回65535</li>
<li>2.检测ROI区域存在问题，前景后景提取失败    65534</li>
<li>3.液面检测失败—（液面无梯度信息，液面高度过低）65533      </li>
</ul>
</li>
</ul>
<hr>
<h4 id="3-工作流程"><a href="#3-工作流程" class="headerlink" title="3.工作流程"></a>3.工作流程</h4><ul>
<li><blockquote>
<p>工作流程：</p>
</blockquote>
</li>
</ul>
<ol>
<li>预处理：试管模板的制作，根据不同试管的尺寸和大小，制作不同的试管下部模板，然后生成下模板二值图和对应的试管类型编号xml文件。<ul>
<li>包含了试管宽度、编号、模板类型信息——满足一套系统，不同尺寸试管的检测要求，只需Modbus通讯时，报文输入对应的使馆编号，按 照对应的试管编号进行类型处理。</li>
</ul>
</li>
<li>建立Modbus TCP通讯连接，树莓派作为服务器（从站），西门子PLC为客户端（主站）</li>
<li>PLC发送对应的Modbus—功能码23（0x17）读写多个保存寄存器，树莓派进行检测，返回对应数据。</li>
<li>PLC根据返回数据，进行判断旋转云台，后再次采集数据，旋转试管至满足要求。<br><img src="/pictures/clipboard42.png" alt="img"><br><img src="/pictures/clipboard43.png" alt="img"></li>
</ol>
<hr>
<h4 id="4-工作流程（精简）"><a href="#4-工作流程（精简）" class="headerlink" title="4.工作流程（精简）"></a>4.工作流程（精简）</h4><ol>
<li>试管进行预处理，对应的生成试管类型编号文件和模板文件</li>
<li>PLC和树莓派进行Modbus TCP通讯，建立主站从站，收发数据。</li>
<li>PLC根据树莓派返回的数据进行 云台的旋转，调整试管位姿至满足状态。</li>
</ol>
<hr>
<h4 id="5-算法"><a href="#5-算法" class="headerlink" title="5.算法"></a>5.算法</h4><ul>
<li>主要分为<strong>棉签位姿判断</strong>和<strong>液面高度判断</strong></li>
</ul>
<ol>
<li>ROI区域前后景分离（OTSU）</li>
<li>液面高度—ROI区域进行倒置，下部区域模板匹配，上部区域Scharr梯度提取液面梯度。<ul>
<li>倒置是为了提取液面低处，同时包含误差检验算法—像素和要求。</li>
</ul>
</li>
<li>ROI区域图像的一阶矩求重心，而阶矩求倾斜角。<ul>
<li>误差检验算法—像素区域和，同时根据液面高度选择极限角度的不同位置</li>
</ul>
</li>
</ol>
<p><img src="/pictures/clipboard44.png" alt="img"></p>
<hr>
<h4 id="6-问题解决"><a href="#6-问题解决" class="headerlink" title="6.问题解决"></a>6.问题解决</h4><ul>
<li><blockquote>
<p>首先使用的边缘检测，误检率比较高?</p>
</blockquote>
</li>
<li><p>后使用背景分离算法。</p>
</li>
<li><blockquote>
<p>前景背景分离时受到外部光线影响较大，如何减小影响？</p>
</blockquote>
</li>
<li><p>解决方法：客户是在室内使用的，所以对外部光线对其影响不大，主要是解决室内光的问题。对相机采用了自适应曝光后，算法稳定性可靠的提升了。</p>
</li>
<li><blockquote>
<p>对于角度的判定存在一定的误差，由于不同的液面，图像的矩的角度极限位置不同</p>
</blockquote>
</li>
<li><p>解决方法：根据实际测量实验，得出了不同液面高度的<strong>修正系数表</strong>，根据液面高度来修正角度极限位置的交点位置。</p>
</li>
</ul>
<hr>
<h4 id="7-硬件选型"><a href="#7-硬件选型" class="headerlink" title="7.硬件选型"></a>7.硬件选型</h4><ul>
<li><blockquote>
<p>相机布局示意图<br><img src="/pictures/clipboard45.png" alt="img"></p>
</blockquote>
</li>
<li><p>视野范围</p>
</li>
<li><p>X方向：200*3.04/3.6=236.8</p>
</li>
<li><p>Y方向：200*3.04/2.7=177.6</p>
</li>
<li><blockquote>
<p>相机参数<br><img src="/pictures/clipboard46.png" alt="img"><br><img src="/pictures/clipboard47.png" alt="img"></p>
</blockquote>
</li>
</ul>
<hr>
<h4 id="8-算法介绍"><a href="#8-算法介绍" class="headerlink" title="8.算法介绍"></a>8.算法介绍</h4><ul>
<li><blockquote>
<p><font size=6>1.OTSU大津法——<strong>最大类间方差法</strong> </font></p>
</blockquote>
</li>
</ul>
<ol>
<li>分割后图像的前景与后景类间方差最大。<ul>
<li>被认为是最佳的阈值分割算法，计算简单不受图像亮度和对比度的影响。</li>
</ul>
</li>
<li>前景和背景的类间方差越大，说明两部分的差别越大。<ul>
<li>当前景和背景错分时，都会导致类间方差变小。所以类间方差最大分割，意味着<strong>错分概率</strong>是最小的。</li>
</ul>
</li>
<li><strong>找到最合适的灰度级K</strong>，使得<strong>类间方差</strong>最大</li>
</ol>
<ul>
<li><blockquote>
<p><img src="/pictures/clipboard48.png" alt="img"><br><img src="/pictures/clipboard49.png" alt="img"><br><img src="/pictures/clipboard50.png" alt="img"></p>
</blockquote>
</li>
</ul>
<hr>
<ul>
<li><blockquote>
<p><font size=6>2.图像的矩求 重心 / 倾斜角 </font></p>
</blockquote>
</li>
</ul>
<ol>
<li>0阶矩——白色区域面积</li>
<li>1阶矩——图像重心</li>
<li>2阶矩——图像倾斜角度</li>
</ol>
<hr>
<ul>
<li><p>定义：图像识别的核心问题就是：图像的特征提取，利用一些简单的数据来描述整个图像。这些数据越简单越有代表性越好。图像识别发展几十年，不断有新的特征提出，而<strong>图像不变矩</strong>就是其中一个。</p>
</li>
<li><p>矩是概率与统计中的一个概念，是随机变量的一种数字特征。</p>
</li>
<li><blockquote>
<p>设x为随机变量，c为常数，k为正整数。则量E[(x-c)k]为x关于c点的k阶矩。</p>
</blockquote>
</li>
<li><p>1.如果E[(x-c)k]存在</p>
<ul>
<li>当c=0，A = E(xk)，称为x的k阶<strong>原点矩</strong></li>
<li>当c=E(x)，A = E( [x-E(x)]k )，称为x的k阶<strong>中心距</strong></li>
</ul>
</li>
<li><p>2.如果E[(x-c1)p * (y-c2)q ]存在，称其为X，Y关于c点<strong>p + q阶矩</strong></p>
</li>
<li><p>不变矩是一处高度浓缩的图像特征，具有<strong>平移、灰度、尺度、旋转不变性。</strong></p>
</li>
</ul>
<ol>
<li>1961M.K.Hu提出了Hu不变矩。</li>
<li>1979M.R.Teague根据正交多项式，提出了Zernike矩</li>
</ol>
<ul>
<li><blockquote>
<p><img src="/pictures/clipboard51.png" alt="img"><br><img src="/pictures/clipboard52.png" alt="img"></p>
</blockquote>
</li>
</ul>
<h2 id="PNP螺丝漏打识别-透视投影"><a href="#PNP螺丝漏打识别-透视投影" class="headerlink" title="PNP螺丝漏打识别 / 透视投影"></a>PNP螺丝漏打识别 / 透视投影</h2></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Inter</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zichuan365.github.io/2020/07/24/%E9%A1%B9%E7%9B%AE-%E6%A0%91%E8%8E%93%E6%B4%BE/">https://zichuan365.github.io/2020/07/24/%E9%A1%B9%E7%9B%AE-%E6%A0%91%E8%8E%93%E6%B4%BE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zichuan365.github.io">Zichuan365' Blog</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/07/24/%E9%A1%B9%E7%9B%AE-%E6%B0%B4%E4%B8%8B%E7%AB%8B%E4%BD%93%E8%A7%86%E8%A7%89-1/"><i class="fa fa-chevron-left">  </i><span>项目 / 水下立体视觉</span></a></div><div class="next-post pull-right"><a href="/2020/07/20/jianzhioffer3/"><span>剑指Offer68 / # 48 - 68</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(/img/6.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2020 By Inter</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>